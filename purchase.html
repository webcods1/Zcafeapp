<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Purchase - ZCafe</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="desktop.css">
  <link rel="stylesheet" href="mobile.css">

  <style>
    @keyframes slideUpFade {
      0% {
        opacity: 0;
        transform: translate(-50%, 20px);
      }

      15% {
        opacity: 1;
        transform: translate(-50%, 0);
      }

      85% {
        opacity: 1;
        transform: translate(-50%, 0);
      }

      100% {
        opacity: 0;
        transform: translate(-50%, -20px);
      }
    }

    @keyframes cartPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.3);
      }
    }
  </style>
</head>

<body>
  <script>

    (function () {
      var loader = document.createElement('div');
      loader.className = 'app-loader';
      loader.innerHTML = '<div class="logo" aria-hidden="true"></div>';
      document.documentElement.appendChild(loader);
      function removeLoader() { loader.classList.add('loaded'); setTimeout(() => { if (loader && loader.parentNode) loader.parentNode.removeChild(loader); }, 350); }
      if (document.readyState === 'complete') removeLoader(); else window.addEventListener('load', removeLoader);
      window.addEventListener('beforeunload', function () { if (!document.documentElement.contains(loader)) document.documentElement.appendChild(loader); });
    })();
  </script>
  <!-- ===== Navbar ===== -->
  <nav>
    <div class="nav-top">
      <div class="search-container">
        <img src="public/logo.png" alt="ZCafe Logo">
        <input type="text" placeholder="Search products...">
      </div>

      <div class="nav-right">
        <div class="nav-icon" id="bell-icon" title="Notifications">
          <svg viewBox="0 0 24 24">
            <path d="M12 24a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2Zm6-6V11a6 6 0 0 0-12 0v7L4 20v1h16v-1Z" />
          </svg>
        </div>
        <div class="nav-icon" id="wishlist-icon" title="Wishlist">
          <svg viewBox="0 0 24 24">
            <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
          </svg>
        </div>
        <div class="nav-icon" id="profile-icon" title="Profile">
          <svg viewBox="0 0 24 24">
            <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5v3h18v-3c0-2.5-4-5-9-5Z" />
          </svg>
        </div>
      </div>
    </div>
    <div class="deliver-to">
      <svg viewBox="0 0 24 24">
        <path
          d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" />
      </svg>

      <span>Deliver To:</span>

      <!-- READ ONLY -->
      <input type="text" id="address-input" readonly>
    </div>
  </nav>


  <!-- ===== Scroll Container ===== -->
  <div class="scroll-container">
    <div class="image-scroll-row">
      <div class="scroll-item" data-name="Coffee Premium" data-img="/zcoffepre.png"
        onclick="showProductQuickView(this)">
        <div class="best-seller-tag">Best Seller</div>
        <img src="/zcoffepre.png" alt="Coffee">
      </div>
      <div class="scroll-item" data-name="Tea Premium" data-img="/ztea.png" onclick="showProductQuickView(this)">
        <div class="offer-tag">UP TO 10% OFF</div>
        <img src="/ztea.png" alt="Tea">
      </div>
      <div class="scroll-item" data-name="Cappuccino" data-img="/cappuccino.png" onclick="showProductQuickView(this)">
        <div class="new-tag">NEW ARRIVAL</div>
        <img src="/cappuccino.png" alt="Cappuccino">
      </div>
      <div class="scroll-item" data-name="Milk Boost" data-img="/boost.png" onclick="showProductQuickView(this)">
        <div class="energy-tag">ENERGY</div>
        <img src="/boost.png" alt="Boost">
      </div>
      <div class="scroll-item" data-name="Coffee Non sugar" data-img="/zcoffe.png" onclick="showProductQuickView(this)">
        <div class="healthy-tag">0% SUGAR</div>
        <img src="/zcoffe.png" alt="Diet Coffee">
      </div>
      <div class="scroll-item" data-name="Milk Horlicks" data-img="/horlicks.png" onclick="showProductQuickView(this)">
        <div class="trending-tag">TRENDING</div>
        <img src="/horlicks.png" alt="Horlicks">
      </div>
    </div>
  </div>

  <!-- ===== Banner Carousel ===== -->
  <div class="banner-carousel container-fluid px-0">

    <div class="carousel-slides mx-auto">

      <div class="banner banner-slide active d-flex justify-content-center align-items-center">
        <video class="banner-video w-xs-100 h-xs-80 h-md-100 h-lg-100" webkit-playsinline playsinline muted loop
          autoplay poster="/bannerDC.png">
          <source src="/DietCoffeeZ.webm" type="video/webm">
        </video>
      </div>

      <div class="banner banner-slide d-flex justify-content-center align-items-center">
        <video class="banner-video w-xs-100 h-xs-80 h-md-100 h-lg-100" webkit-playsinline playsinline muted loop
          autoplay poster="/bannerPT.png">
          <source src="/PremiumTeaZ.webm" type="video/webm">
        </video>
      </div>

      <div class="banner banner-slide d-flex justify-content-center align-items-center">
        <video class="banner-video w-xs-100 h-xs-80 h-md-100 h-lg-100" webkit-playsinline playsinline muted loop
          autoplay poster="/bannerMB.png">
          <source src="/MilkBoostZ.webm" type="video/webm">
        </video>
      </div>

      <div class="banner banner-slide d-flex justify-content-center align-items-center">
        <video class="banner-video w-xs-100 h-xs-80 h-md-100 h-lg-100" webkit-playsinline playsinline muted loop
          autoplay poster="/bannerMH.png">
          <source src="/MilkhorlicksZ.webm" type="video/webm">
        </video>
      </div>

      <div class="banner banner-slide d-flex justify-content-center align-items-center">
        <video class="banner-video w-xs-100 h-xs-80 h-md-100 h-lg-100" webkit-playsinline playsinline muted loop
          autoplay poster="/bannerCA.png">
          <source src="/cappuccinoZ.webm" type="video/webm">
        </video>
      </div>

    </div>

    <div class="carousel-dots">
      <span class="dot active"></span>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>

  </div>

  <!-- ===== Product Cards ===== -->
  <section class="products-section">
    <h2>Shop</h2>
    <p>Discover our selection of beverages, crafted to perfection for your enjoyment</p>
    <div class="products-wrapper">
      <div class="products-grid">
        <div class="product-card" data-name="Coffee Non sugar">
          <img src="/zcoffe.png" alt="Coffee">
          <div class="product-info">
            <h3 class="visible">Coffee Non sugar</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
        <div class="product-card" data-name="Tea Premium">
          <img src="/ztea.png" alt="Tea">
          <div class="product-info">
            <h3>Tea Premium</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
        <div class="product-card" data-name="Milk Boost">
          <img src="/boost.png" alt="Milk Boost">
          <div class="product-info">
            <h3>Milk Boost</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
        <div class="product-card" data-name="Cappuccino">
          <img src="/cappuccino.png" alt="Capuccino">
          <div class="product-info">
            <h3>Cappuccino</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
        <div class="product-card" data-name="Milk Horlicks">
          <img src="/horlicks.png" alt="Horlicks">
          <div class="product-info">
            <h3>Milk Horlicks</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
        <div class="product-card" data-name="Coffee Premium">
          <img src="/zcoffepre.png" alt="Coffee Premium">
          <div class="product-info">
            <h3>Coffee Premium</h3>
            <div class="quantity-row">
              <input type="number" min="1" value="1" class="quantity-input">
              <button class="wishlist-btn" title="Add to Wishlist"
                style="background:none; border:none; cursor:pointer;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ff5900">
                  <path d="M12 21s-8-4.58-8-11a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 6.42-8 11-8 11Z" />
                </svg>
              </button>
            </div>
            <button class="add-cart-btn">Add to Cart</button>
          </div>
        </div>
      </div>
  </section>

  <!-- ===== Footer ===== -->
  <footer class="footer">
    <p>&copy; 2025 ZCafe. All rights reserved by Webcods</p>
  </footer>

  <!-- ===== Bottom Navigation ===== -->
  <div class="bottom-nav">
    <a class="nav-item" href="index.html" id="home-link">
      <svg viewBox="0 0 24 24">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2h-4v-7h-6v7H5a2 2 0 0 1-2-2Z" />
      </svg>
      Home
    </a>
    <a class="nav-item active" href="purchase.html" id="purchase-link">
      <svg viewBox="0 0 24 24">
        <path d="M20 7l-8-4-8 4v10l8 4 8-4z M12 3v10 M8 5v10 M16 5v10" />
      </svg>
      Purchase
    </a>
    <a class="nav-item" href="service.html" id="service-link">
      <svg viewBox="0 0 24 24" fill="#000">
        <path
          d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
      </svg>
      Service
    </a>
    <a class="nav-item" href="bag.html" id="bag-link">
      <svg viewBox="0 0 24 24">
        <path d="M6 7V6a6 6 0 0 1 12 0v1h2v14H4V7Zm2 0h8V6a4 4 0 0 0-8 0Z" />
      </svg>
      Cart
    </a>
  </div>

  <script>
    // ================= DELIVERY ADDRESS (FROM PROFILE) =================
    document.addEventListener("DOMContentLoaded", () => {
      const addressInput = document.getElementById("address-input");
      const deliverToSpan = document.querySelector(".deliver-to span");

      const companyName = localStorage.getItem("companyName");
      const deliveryAddress = localStorage.getItem("deliveryAddress");

      // Label
      if (companyName) {
        deliverToSpan.textContent = `Deliver To (${companyName}):`;
      } else {
        deliverToSpan.textContent = "Deliver To:";
      }

      // Address
      if (deliveryAddress) {
        addressInput.value = deliveryAddress;
      } else {
        addressInput.value = "Please set delivery address in profile";
      }

      // ðŸ”’ READ ONLY (PROFILE CONTROLS IT)
      addressInput.readOnly = true;
    });
    // search recommendations
    const searchInput = document.querySelector('.search-container input');
    const recommendations = ['Coffee Non sugar', 'Tea Premium', 'Milk Boost', 'Cappuccino', 'Milk Horlicks', 'Coffee Premium'];

    // Create dropdown for suggestions
    const dropdown = document.createElement('div');
    dropdown.style.position = 'absolute';
    dropdown.style.top = '100%';
    dropdown.style.left = '50%';
    dropdown.style.transform = 'translateX(-50%)';
    dropdown.style.width = '250px';
    dropdown.style.background = 'white';
    dropdown.style.border = '1px solid #ccc';
    dropdown.style.borderRadius = '10px';
    dropdown.style.maxHeight = '500px';
    dropdown.style.overflowY = 'auto';
    dropdown.style.display = 'none';
    dropdown.style.zIndex = '1000';
    dropdown.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.08)';
    document.querySelector('.search-container').appendChild(dropdown);

    searchInput.addEventListener('input', () => {
      showSuggestions();
      // If search input is empty, show all products
      if (!searchInput.value.trim()) {
        document.querySelectorAll('.product-card').forEach(card => {
          card.style.display = 'block';
          card.classList.remove('searched');
        });
      }
    });

    // Show recommendations on input focus
    searchInput.addEventListener('focus', () => {
      if (!searchInput.value.trim()) {
        searchInput.placeholder = `Try: ${recommendations.join(', ')}`;
      }
      showSuggestions();
    });

    searchInput.addEventListener('blur', () => {
      if (!searchInput.value.trim()) {
        searchInput.placeholder = 'Search products...';
      }
    });

    // Hide dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!document.querySelector('.search-container').contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });

    // Function to filter products based on query
    function filterProducts(query) {
      document.querySelectorAll('.product-card').forEach(card => {
        const name = card.dataset.name.toLowerCase();
        if (name.includes(query.toLowerCase())) {
          card.style.display = 'block';
          card.classList.add('searched');
        } else {
          card.style.display = 'none';
          card.classList.remove('searched');
        }
      });
    }

    // Handle URL parameters for search or product selection
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('search');
    const selectedProduct = urlParams.get('product');

    if (selectedProduct) {
      // Show only the exact selected product card
      document.querySelectorAll('.product-card').forEach(card => {
        if (card.dataset.name === selectedProduct) {
          card.style.display = 'block';
          card.classList.add('searched');
        } else {
          card.style.display = 'none';
          card.classList.remove('searched');
        }
      });
      searchInput.value = selectedProduct;
    } else if (searchQuery) {
      // Show products that match the search query
      filterProducts(searchQuery);
      searchInput.value = searchQuery;
    }

    // ================= DELIVERY ADDRESS (FROM PROFILE) =================
    document.addEventListener("DOMContentLoaded", () => {
      const addressInput = document.getElementById("address-input");
      const deliverToSpan = document.querySelector(".deliver-to span");

      const companyName = localStorage.getItem("companyName");
      const deliveryAddress = localStorage.getItem("deliveryAddress");

      // Label
      if (companyName) {
        deliverToSpan.textContent = `Deliver To (${companyName}):`;
      } else {
        deliverToSpan.textContent = "Deliver To:";
      }

      // Address
      if (deliveryAddress) {
        if (addressInput) addressInput.value = deliveryAddress;
      } else {
        if (addressInput) addressInput.value = "Please set delivery address in profile";
      }

      // ðŸ”’ READ ONLY (PROFILE CONTROLS IT)
      if (addressInput) addressInput.readOnly = true;
    });

    // Function to show suggestions
    function showSuggestions() {
      const query = searchInput.value.toLowerCase().trim();
      dropdown.innerHTML = '';
      if (query) {
        const filtered = recommendations.filter(item => item.toLowerCase().includes(query));
        filtered.forEach(item => {
          const div = document.createElement('div');
          div.textContent = item;
          div.style.padding = '10px';
          div.style.cursor = 'pointer';
          div.style.borderRadius = '10px';
          div.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.08)';
          div.style.background = 'white';
          div.style.margin = '5px 0';
          div.addEventListener('click', () => {
            window.location.href = `purchase.html?product=${encodeURIComponent(item)}`;
          });
          dropdown.appendChild(div);
        });
        dropdown.style.display = filtered.length ? 'block' : 'none';
      } else {
        dropdown.style.display = 'none';
      }
    }
    /* =================
     CART LOGIC (FIXED)
    /* ========================================================= */
    let cart = JSON.parse(localStorage.getItem("cartItems")) || [];

    const cartBadge = document.createElement("div");
    cartBadge.className = "cart-badge";
    cartBadge.style.cssText = `
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff0000;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 11px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    `;

    const bagLink = document.getElementById("bag-link");
    bagLink.style.position = "relative";
    bagLink.appendChild(cartBadge);

    function updateBadge() {
      const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
      cartBadge.textContent = totalQty;
      cartBadge.style.display = totalQty > 0 ? "flex" : "none";
    }

    // Animated cart notification function
    function showCartNotification(productName) {
      // Update badge first
      updateBadge();

      // Create floating notification
      const notification = document.createElement('div');
      notification.textContent = `${productName} added!`;
      notification.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
        animation: slideUpFade 2s ease-out forwards;
      `;
      document.body.appendChild(notification);

      // Pulse the cart badge
      cartBadge.style.animation = 'cartPulse 0.5s ease-out';
      setTimeout(() => {
        cartBadge.style.animation = '';
      }, 500);

      // Remove notification after animation
      setTimeout(() => {
        notification.remove();
      }, 2000);
    }

    updateBadge();

    /* âœ… ADD TO CART LOGIC */
    document.querySelectorAll(".add-cart-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const address = localStorage.getItem("deliveryAddress");
        if (!address) {
          alert("Please set delivery address in Profile first.");
          window.location.href = "profile.html";
          return;
        }

        const card = btn.closest(".product-card");
        const name = card.dataset.name;
        const quantity = parseInt(card.querySelector(".quantity-input").value) || 1;

        // Update global cart variable
        cart = JSON.parse(localStorage.getItem("cartItems")) || [];
        const existing = cart.find(item => item.name === name);
        if (existing) {
          existing.quantity += quantity;
        } else {
          cart.push({ name, quantity });
        }

        localStorage.setItem("cartItems", JSON.stringify(cart));
        showCartNotification(`${quantity}Ã— ${name}`);
      });
    });



    // navbar profile icon click event
    document.getElementById("profile-icon").addEventListener("click", () => {
      window.location.href = "profile.html";
    });

    // wishlist icon click event
    document.getElementById("wishlist-icon").addEventListener("click", () => {
      window.location.href = "wishlist.html";
    });

    // wishlist logic
    const wishlistBadge = document.createElement("div");
    wishlistBadge.style.position = "absolute";
    wishlistBadge.style.top = "-5px";
    wishlistBadge.style.right = "-5px";
    wishlistBadge.style.background = "red";
    wishlistBadge.style.color = "white";
    wishlistBadge.style.borderRadius = "50%";
    wishlistBadge.style.width = "18px";
    wishlistBadge.style.height = "18px";
    wishlistBadge.style.fontSize = "12px";
    wishlistBadge.style.display = "flex";
    wishlistBadge.style.alignItems = "center";
    wishlistBadge.style.justifyContent = "center";
    wishlistBadge.style.fontWeight = "bold";
    document.getElementById("wishlist-icon").appendChild(wishlistBadge);

    // notification popup
    const wishlistNotification = document.createElement("div");
    wishlistNotification.style.position = "absolute";
    wishlistNotification.style.top = "-30px";
    wishlistNotification.style.left = "50%";
    wishlistNotification.style.transform = "translateX(-50%)";
    wishlistNotification.style.background = "black";
    wishlistNotification.style.color = "white";
    wishlistNotification.style.padding = "5px 10px";
    wishlistNotification.style.borderRadius = "5px";
    wishlistNotification.style.fontSize = "12px";
    wishlistNotification.style.display = "none";
    wishlistNotification.style.whiteSpace = "nowrap";
    wishlistNotification.style.zIndex = "1000";
    document.getElementById("wishlist-icon").style.position = "relative";
    document.getElementById("wishlist-icon").appendChild(wishlistNotification);

    // function to update wishlist badge
    function updateWishlistBadge() {
      let wishlist = JSON.parse(localStorage.getItem("wishlistItems")) || [];
      let totalQty = wishlist.reduce((sum, item) => sum + item.quantity, 0);
      wishlistBadge.textContent = totalQty;
      wishlistBadge.style.display = totalQty > 0 ? "flex" : "none";

      if (totalQty > 0) {
        wishlistNotification.textContent = `${totalQty} item(s) added to wishlist`;
        wishlistNotification.style.display = "block";
        setTimeout(() => {
          wishlistNotification.style.display = "none";
        }, 2000);
      }
    }

    updateWishlistBadge();

    let wishlist = JSON.parse(localStorage.getItem("wishlistItems")) || [];

    function updateHeart(btn, isInWishlist) {
      const svg = btn.querySelector('svg');
      svg.setAttribute('fill', isInWishlist ? 'red' : 'none');
      svg.setAttribute('stroke', isInWishlist ? 'none' : 'black');
      svg.setAttribute('stroke-width', isInWishlist ? '0' : '2');
    }

    // initialize hearts
    document.querySelectorAll('.wishlist-btn').forEach(btn => {
      const card = btn.closest('.product-card');
      const name = card.dataset.name;
      const isInWishlist = wishlist.some(item => item.name === name);
      updateHeart(btn, isInWishlist);
    });

    // wishlist button click event
    document.querySelectorAll(".wishlist-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const card = btn.closest(".product-card");
        const name = card.dataset.name;
        const quantity = parseInt(card.querySelector(".quantity-input").value);

        const existingIndex = wishlist.findIndex(item => item.name === name);
        if (existingIndex !== -1) {
          // remove from wishlist
          wishlist.splice(existingIndex, 1);
          updateHeart(btn, false);
          alert(`${name} removed from wishlist!`);
        } else {
          // add to wishlist
          wishlist.push({ name, quantity });
          updateHeart(btn, true);
          alert(`${quantity} x ${name} added to wishlist!`);
        }
        localStorage.setItem("wishlistItems", JSON.stringify(wishlist));
        updateWishlistBadge();
        let totalQty = wishlist.reduce((sum, item) => sum + item.quantity, 0);
        if (totalQty > 0) {
          wishlistNotification.textContent = `${totalQty} item(s) in wishlist`;
          wishlistNotification.style.display = "block";
          setTimeout(() => {
            wishlistNotification.style.display = "none";
          }, 2000);
        }
      });
    });

    // Scroll-triggered animation for product images
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);

    // Observe all product images
    document.querySelectorAll('.products-grid img, .product-card img').forEach(img => {
      observer.observe(img);
    });

    // Observe h2, p, h3, sections, and product cards for fade-in
    document.querySelectorAll('h2, p, h3, section, .product-card').forEach(element => {
      observer.observe(element);
    });

    // Banner slider logic
    let currentSlide = 0;
    const slides = Array.from(document.querySelectorAll('.banner-slide'));
    const dots = Array.from(document.querySelectorAll('.dot'));

    function showSlide(index) {
      slides.forEach((s, i) => {
        const active = i === index;
        s.classList.toggle('active', active);
        const vid = s.querySelector('video');
        if (vid) {
          if (active) {
            const p = vid.play();
            if (p && p.catch) p.catch(() => { });
          } else {
            try { vid.pause(); vid.currentTime = 0; } catch (e) { }
          }
        }
      });
      dots.forEach((d, i) => d.classList.toggle('active', i === index));
      currentSlide = index;
    }

    function nextSlide() {
      showSlide((currentSlide + 1) % slides.length);
    }

    function prevSlide() {
      showSlide((currentSlide - 1 + slides.length) % slides.length);
    }

    // auto-advance
    const slideInterval = setInterval(nextSlide, 5000);

    // dot controls
    dots.forEach(dot => dot.addEventListener('click', (e) => {
      const idx = Number(dot.dataset.slide);
      if (!Number.isNaN(idx)) showSlide(idx);
    }));

    // initialize
    if (slides.length) showSlide(0);

    // Scroll hide/show bottom navbar only
    let lastScrollTop = 0;
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const bottomNav = document.querySelector('.bottom-nav');
      if (scrollTop > lastScrollTop) {
        // scrolling down
        if (bottomNav) bottomNav.classList.add('hidden');
      } else {
        // scrolling up
        if (bottomNav) bottomNav.classList.remove('hidden');
      }
      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });

    function updateDeliverTo() {
      const addressInput = document.getElementById("address-input");
      const deliverToSpan = document.querySelector(".deliver-to span");

      const companyName = localStorage.getItem("companyName");
      const location = localStorage.getItem("location"); // ADDRESS from profile.html

      if (!location) {
        deliverToSpan.textContent = "Deliver To:";
        addressInput.value = "Please set delivery address in Profile";
        addressInput.style.color = "#aa0a0a";
        return;
      }

      // Show company name if exists
      if (companyName) {
        deliverToSpan.textContent = `Deliver To (${companyName}):`;
      } else {
        deliverToSpan.textContent = "Deliver To:";
      }

      addressInput.value = location;
      addressInput.style.color = "#000";
    }

    // Run on page load
    document.addEventListener("DOMContentLoaded", updateDeliverTo);

    // Auto-refresh if profile is updated in another tab
    window.addEventListener("storage", (e) => {
      if (e.key === "location" || e.key === "companyName") {
        updateDeliverTo();
      }
    });
    document.getElementById("profile-icon").addEventListener("click", () => {
      window.location.href = "profile.html";
    });

    document.getElementById("bell-icon").addEventListener("click", () => {
      window.location.href = "notification.html";
    });


    document.getElementById("wishlist-icon").addEventListener("click", () => {
      window.location.href = "wishlist.html";
    });

    // Swinging tag effect on horizontal scroll
    const scrollRow = document.querySelector('.image-scroll-row');
    const tags = document.querySelectorAll('.best-seller-tag, .offer-tag, .new-tag, .energy-tag, .healthy-tag, .trending-tag');
    let scrollTimeout;

    if (scrollRow) {
      scrollRow.addEventListener('scroll', () => {
        tags.forEach(tag => tag.classList.add('swinging'));

        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          tags.forEach(tag => tag.classList.remove('swinging'));
        }, 500); // Stop swinging 500ms after scroll stops
      });
    }

    function showProductQuickView(element) {
      const productName = element.getAttribute('data-name');
      const productImg = element.getAttribute('data-img');

      document.getElementById('modal-product-img').src = productImg;
      document.getElementById('modal-product-name').innerText = productName;
      document.getElementById('modal-overlay').classList.add('active');
    }

    function closeProductModal() {
      document.getElementById('modal-overlay').classList.remove('active');
    }

    function confirmAddToCart() {
      const productName = document.getElementById('modal-product-name').innerText;
      cart = JSON.parse(localStorage.getItem("cartItems")) || [];

      const existingItem = cart.find(item => item.name === productName);
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({ name: productName, quantity: 1 });
      }

      localStorage.setItem("cartItems", JSON.stringify(cart));
      showCartNotification(productName);

      // Close modal
      closeProductModal();
    }
  </script>
  <!-- ===== Product Quick View Modal ===== -->
  <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this) closeProductModal()">
    <div class="quick-card">
      <button class="close-modal" onclick="closeProductModal()">&times;</button>
      <img src="" alt="Product Image" id="modal-product-img">
      <h3 id="modal-product-name">Product Name</h3>
      <p>Premium quality selection from ZCafe. Perfectly crafted for your delight.</p>
      <button class="modal-add-btn" onclick="confirmAddToCart()">
        <i class="fas fa-shopping-cart"></i> Add to Cart
      </button>
    </div>
  </div>

  <!-- Bootstrap 5 JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const dbApp = initializeApp({
      apiKey: "AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",
      databaseURL: "https://zcafe-65f97-default-rtdb.firebaseio.com"
    });
    const realtimeDb = getDatabase(dbApp);

    const bellIcon = document.getElementById("bell-icon");
    const notificationBadge = document.createElement("div");
    notificationBadge.style.position = "absolute";
    notificationBadge.style.top = "-5px";
    notificationBadge.style.right = "-5px";
    notificationBadge.style.background = "red";
    notificationBadge.style.color = "white";
    notificationBadge.style.borderRadius = "50%";
    notificationBadge.style.width = "18px";
    notificationBadge.style.height = "18px";
    notificationBadge.style.fontSize = "12px";
    notificationBadge.style.display = "none";
    notificationBadge.style.alignItems = "center";
    notificationBadge.style.justifyContent = "center";
    notificationBadge.style.fontWeight = "bold";
    notificationBadge.style.zIndex = "10";
    if (bellIcon) {
      bellIcon.style.position = "relative";
      bellIcon.appendChild(notificationBadge);
    }

    const notifSound = document.createElement("audio");
    notifSound.src = "https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3";
    document.body.appendChild(notifSound);

    let lastKnownNotifTime = parseInt(localStorage.getItem("lastNotifSeen") || "0");

    onValue(ref(realtimeDb, "notifications"), snap => {
      if (snap.exists()) {
        const data = snap.val();
        const userLoc = localStorage.getItem("deliveryAddress") || "";
        const userComp = localStorage.getItem("companyName") || "";
        const lastSeen = parseInt(localStorage.getItem("lastNotifSeen") || "0");

        let unreadCount = 0;
        let newestInCurrentBatch = 0;

        Object.values(data).forEach(n => {
          const matchLoc = n.targetLocation === "all" || n.targetLocation === userLoc;
          const matchComp = n.targetCompany === "all" || n.targetCompany === userComp;
          const notifTime = new Date(n.timestamp).getTime();

          if (matchLoc && matchComp) {
            if (notifTime > lastSeen) unreadCount++;
            if (notifTime > newestInCurrentBatch) newestInCurrentBatch = notifTime;
          }
        });

        if (newestInCurrentBatch > lastKnownNotifTime) {
          notifSound.play().catch(e => console.log("Sound error:", e));
          lastKnownNotifTime = newestInCurrentBatch;
        }

        notificationBadge.textContent = unreadCount;
        notificationBadge.style.display = unreadCount > 0 ? "flex" : "none";
      }
    });
  </script>
</body>

</html>