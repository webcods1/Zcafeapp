import{_ as O}from"./preload-helper-BXl3LOEh.js";/*! Capacitor: https://capacitorjs.com/ - MIT License */const ee=i=>{const e=new Map;e.set("web",{name:"web"});const t=i.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},r=(n,c)=>{t.platforms.set(n,c)},s=n=>{t.platforms.has(n)&&(t.currentPlatform=t.platforms.get(n))};return t.addPlatform=r,t.setPlatform=s,t},te=i=>i.CapacitorPlatforms=ee(i),H=te(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});H.addPlatform;H.setPlatform;var A;(function(i){i.Unimplemented="UNIMPLEMENTED",i.Unavailable="UNAVAILABLE"})(A||(A={}));class x extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}}const ie=i=>{var e,t;return i?.androidBridge?"android":!((t=(e=i?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},ne=i=>{var e,t,r,s,n;const c=i.CapacitorCustomPlatform||null,o=i.Capacitor||{},u=o.Plugins=o.Plugins||{},a=i.CapacitorPlatforms,m=()=>c!==null?c.name:ie(i),p=((e=a?.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||m,k=()=>p()!=="web",S=((t=a?.currentPlatform)===null||t===void 0?void 0:t.isNativePlatform)||k,I=l=>{const d=z.get(l);return!!(d?.platforms.has(p())||U(l))},K=((r=a?.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||I,B=l=>{var d;return(d=o.PluginHeaders)===null||d===void 0?void 0:d.find(L=>L.name===l)},U=((s=a?.currentPlatform)===null||s===void 0?void 0:s.getPluginHeader)||B,G=l=>i.console.error(l),V=(l,d,L)=>Promise.reject(`${L} does not have an implementation of "${d}".`),z=new Map,Y=(l,d={})=>{const L=z.get(l);if(L)return console.warn(`Capacitor plugin "${l}" already registered. Cannot register plugins twice.`),L.proxy;const E=p(),C=U(l);let v;const Z=async()=>(!v&&E in d?v=typeof d[E]=="function"?v=await d[E]():v=d[E]:c!==null&&!v&&"web"in d&&(v=typeof d.web=="function"?v=await d.web():v=d.web),v),Q=(f,g)=>{var w,P;if(C){const y=C?.methods.find(h=>g===h.name);if(y)return y.rtype==="promise"?h=>o.nativePromise(l,g.toString(),h):(h,N)=>o.nativeCallback(l,g.toString(),h,N);if(f)return(w=f[g])===null||w===void 0?void 0:w.bind(f)}else{if(f)return(P=f[g])===null||P===void 0?void 0:P.bind(f);throw new x(`"${l}" plugin is not implemented on ${E}`,A.Unimplemented)}},$=f=>{let g;const w=(...P)=>{const y=Z().then(h=>{const N=Q(h,f);if(N){const T=N(...P);return g=T?.remove,T}else throw new x(`"${l}.${f}()" is not implemented on ${E}`,A.Unimplemented)});return f==="addListener"&&(y.remove=async()=>g()),y};return w.toString=()=>`${f.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:f,writable:!1,configurable:!1}),w},R=$("addListener"),M=$("removeListener"),X=(f,g)=>{const w=R({eventName:f},g),P=async()=>{const h=await w;M({eventName:f,callbackId:h},g)},y=new Promise(h=>w.then(()=>h({remove:P})));return y.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await P()},y},D=new Proxy({},{get(f,g){switch(g){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return C?X:R;case"removeListener":return M;default:return $(g)}}});return u[l]=D,z.set(l,{name:l,proxy:D,platforms:new Set([...Object.keys(d),...C?[E]:[]])}),D},J=((n=a?.currentPlatform)===null||n===void 0?void 0:n.registerPlugin)||Y;return o.convertFileSrc||(o.convertFileSrc=l=>l),o.getPlatform=p,o.handleError=G,o.isNativePlatform=S,o.isPluginAvailable=K,o.pluginMethodNoop=V,o.registerPlugin=J,o.Exception=x,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,o.platform=o.getPlatform(),o.isNative=o.isNativePlatform(),o},oe=i=>i.Capacitor=ne(i),_=oe(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),j=_.registerPlugin;_.Plugins;class q{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n),r&&this.sendRetainedArgumentsForEvent(e);const c=async()=>this.removeListener(e,t);return Promise.resolve({remove:c})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,r){const s=this.listeners[e];if(!s){if(r){let n=this.retainedEventArguments[e];n||(n=[]),n.push(t),this.retainedEventArguments[e]=n}return}s.forEach(n=>n(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new _.Exception(e,A.Unimplemented)}unavailable(e="not available"){return new _.Exception(e,A.Unavailable)}async removeListener(e,t){const r=this.listeners[e];if(!r)return;const s=r.indexOf(t);this.listeners[e].splice(s,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(r=>{this.notifyListeners(e,r)}))}}const W=i=>encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),F=i=>i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class re extends q{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[s,n]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=F(s).trim(),n=F(n).trim(),t[s]=n}),t}async setCookie(e){try{const t=W(e.key),r=W(e.value),s=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),c=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${s}; path=${n}; ${c};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}j("CapacitorCookies",{web:()=>new re});const se=async i=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const s=r.result;e(s.indexOf(",")>=0?s.split(",")[1]:s)},r.onerror=s=>t(s),r.readAsDataURL(i)}),ae=(i={})=>{const e=Object.keys(i);return Object.keys(i).map(s=>s.toLocaleLowerCase()).reduce((s,n,c)=>(s[n]=i[e[c]],s),{})},ce=(i,e=!0)=>i?Object.entries(i).reduce((r,s)=>{const[n,c]=s;let o,u;return Array.isArray(c)?(u="",c.forEach(a=>{o=e?encodeURIComponent(a):a,u+=`${n}=${o}&`}),u.slice(0,-1)):(o=e?encodeURIComponent(c):c,u=`${n}=${o}`),`${r}&${u}`},"").substr(1):null,le=(i,e={})=>{const t=Object.assign({method:i.method||"GET",headers:i.headers},e),s=ae(i.headers)["content-type"]||"";if(typeof i.data=="string")t.body=i.data;else if(s.includes("application/x-www-form-urlencoded")){const n=new URLSearchParams;for(const[c,o]of Object.entries(i.data||{}))n.set(c,o);t.body=n.toString()}else if(s.includes("multipart/form-data")||i.data instanceof FormData){const n=new FormData;if(i.data instanceof FormData)i.data.forEach((o,u)=>{n.append(u,o)});else for(const o of Object.keys(i.data))n.append(o,i.data[o]);t.body=n;const c=new Headers(t.headers);c.delete("content-type"),t.headers=c}else(s.includes("application/json")||typeof i.data=="object")&&(t.body=JSON.stringify(i.data));return t};class de extends q{async request(e){const t=le(e,e.webFetchExtra),r=ce(e.params,e.shouldEncodeUrlParams),s=r?`${e.url}?${r}`:e.url,n=await fetch(s,t),c=n.headers.get("content-type")||"";let{responseType:o="text"}=n.ok?e:{};c.includes("application/json")&&(o="json");let u,a;switch(o){case"arraybuffer":case"blob":a=await n.blob(),u=await se(a);break;case"json":u=await n.json();break;case"document":case"text":default:u=await n.text()}const m={};return n.headers.forEach((p,k)=>{m[k]=p}),{data:u,headers:m,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}j("CapacitorHttp",{web:()=>new de});const b=j("PushNotifications",{});class ue{constructor(){this.isNative=_.isNativePlatform(),this.messaging=null,this.fcmToken=null,this.initialized=!1}async initialize(){if(this.initialized){console.log("Notification manager already initialized");return}try{this.isNative?await this.initializeNativeNotifications():await this.initializeWebNotifications(),this.initialized=!0,console.log("Notification manager initialized successfully")}catch(e){throw console.error("Error initializing notification manager:",e),e}}async initializeNativeNotifications(){console.log("Initializing native notifications...");let e=await b.checkPermissions();if(e.receive==="prompt"&&(e=await b.requestPermissions()),e.receive!=="granted"){console.warn("Push notification permission not granted");return}await b.register(),b.addListener("registration",t=>{console.log("Push registration success, token: "+t.value),this.fcmToken=t.value,this.saveTokenToDatabase(t.value)}),b.addListener("registrationError",t=>{console.error("Error on registration: "+JSON.stringify(t))}),b.addListener("pushNotificationReceived",t=>{console.log("Push notification received: ",t),this.handleNotificationReceived(t)}),b.addListener("pushNotificationActionPerformed",t=>{console.log("Push notification action performed",t),this.handleNotificationAction(t)}),console.log("Native notifications initialized")}async initializeWebNotifications(){if(console.log("Initializing web notifications..."),!("serviceWorker"in navigator)){console.warn("Service workers are not supported");return}if(!("Notification"in window)){console.warn("Notifications are not supported");return}try{const e=await navigator.serviceWorker.register("/firebase-messaging-sw.js");console.log("Service Worker registered:",e);const{initializeApp:t}=await O(async()=>{const{initializeApp:a}=await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js");return{initializeApp:a}},[]),{getMessaging:r,getToken:s,onMessage:n}=await O(async()=>{const{getMessaging:a,getToken:m,onMessage:p}=await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-messaging.js");return{getMessaging:a,getToken:m,onMessage:p}},[]),o=t({apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",authDomain:"zcafe-65f97.firebaseapp.com",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com",projectId:"zcafe-65f97",storageBucket:"zcafe-65f97.firebasestorage.app",messagingSenderId:"480288327990",appId:"1:480288327990:web:9c79040289023919034b97",measurementId:"G-HKLYPNGTET"});if(this.messaging=r(o),await Notification.requestPermission()==="granted"){console.log("Notification permission granted");const a=await s(this.messaging,{vapidKey:"YOUR_VAPID_KEY_HERE",serviceWorkerRegistration:e});a?(console.log("FCM Token:",a),this.fcmToken=a,this.saveTokenToDatabase(a)):console.warn("No registration token available."),n(this.messaging,m=>{console.log("Message received (foreground): ",m),this.showForegroundNotification(m)})}else console.warn("Notification permission denied")}catch(e){throw console.error("Error initializing web notifications:",e),e}}async saveTokenToDatabase(e){try{const t=localStorage.getItem("userId")||"anonymous",r=localStorage.getItem("deliveryAddress")||"",s=localStorage.getItem("companyName")||"",{initializeApp:n}=await O(async()=>{const{initializeApp:k}=await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js");return{initializeApp:k}},[]),{getDatabase:c,ref:o,set:u}=await O(async()=>{const{getDatabase:k,ref:S,set:I}=await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js");return{getDatabase:k,ref:S,set:I}},[]),m=n({apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com"},"notification-app"),p=c(m);await u(o(p,`fcm_tokens/${t}`),{token:e,deliveryAddress:r,companyName:s,platform:this.isNative?_.getPlatform():"web",timestamp:Date.now(),updatedAt:new Date().toISOString()}),console.log("FCM token saved to database")}catch(t){console.error("Error saving token to database:",t)}}handleNotificationReceived(e){this.playNotificationSound(),console.log("Notification received:",e)}handleNotificationAction(e){const t=e.notification.data;t&&t.page?window.location.href=t.page:window.location.href="/notification.html"}showForegroundNotification(e){const t=e.notification?.title||e.data?.title||"ZCafe Notification",r={body:e.notification?.body||e.data?.message||"You have a new notification",icon:"/logo.png",badge:"/logo.png",vibrate:[200,100,200],tag:"zcafe-notification",requireInteraction:!1};Notification.permission==="granted"&&new Notification(t,r),this.playNotificationSound()}playNotificationSound(){try{new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3").play().catch(t=>console.log("Error playing notification sound:",t))}catch(e){console.error("Error playing sound:",e)}}getToken(){return this.fcmToken}isSupported(){return this.isNative?!0:"Notification"in window&&"serviceWorker"in navigator}async getPermissionStatus(){return this.isNative?(await b.checkPermissions()).receive:"Notification"in window?Notification.permission:"unsupported"}async requestPermission(){return this.isNative?(await b.requestPermissions()).receive==="granted":"Notification"in window?await Notification.requestPermission()==="granted":!1}}const ge=new ue;export{ge as n};
