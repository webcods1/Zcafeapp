import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                *//* empty css               */import{initializeApp as E}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getDatabase as L,push as T,ref as I,query as O,orderByChild as M,equalTo as $,onValue as x}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";const A={apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",authDomain:"zcafe-65f97.firebaseapp.com",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com",projectId:"zcafe-65f97",storageBucket:"zcafe-65f97.firebasestorage.app",messagingSenderId:"480288327990",appId:"1:480288327990:web:9c79040289023919034b97"},P=E(A),k=L(P);let a=JSON.parse(localStorage.getItem("cartItems"))||[];const b=document.getElementById("bag-items"),B=document.getElementById("cart-badge");function q(){const o=a.reduce((n,r)=>n+r.quantity,0);B.textContent=o,B.style.display=o>0?"flex":"none"}function p(){b.innerHTML="";const o=document.querySelector(".actions"),n=document.getElementById("empty-cart-message");if(!a.length){b.innerHTML="",o&&(o.style.display="none"),n&&(n.style.display="block"),q();return}o&&(o.style.display="flex"),n&&(n.style.display="none"),a.forEach((r,e)=>{const t=document.createElement("div");t.className="bag-item",t.innerHTML=`
          <h3>${r.name}</h3>
          <input type="number" min="1" value="${r.quantity}">
          <button class="remove-btn">Remove</button>
        `,t.querySelector("input").onchange=y=>N(e,y.target.value),t.querySelector(".remove-btn").onclick=()=>z(e),b.appendChild(t)}),q()}function N(o,n){a[o].quantity=parseInt(n),localStorage.setItem("cartItems",JSON.stringify(a)),p()}function z(o){a.splice(o,1),localStorage.setItem("cartItems",JSON.stringify(a)),p()}p();document.getElementById("book-btn").addEventListener("click",()=>{if(!a.length){alert("Your bag is empty!");return}const o=localStorage.getItem("phoneNumber"),n=localStorage.getItem("deliveryAddress"),r=localStorage.getItem("deliverFrom"),e=localStorage.getItem("companyName");if(!o||!n||!r){alert("Please complete Profile (Phone, Address, Branch)"),window.location.href="profile.html";return}const t=new Date,y=String(t.getDate()).padStart(2,"0"),c=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear(),f=String(t.getHours()).padStart(2,"0"),g=String(t.getMinutes()).padStart(2,"0"),u=String(t.getSeconds()).padStart(2,"0"),s=`${y}/${c}/${i}, ${f}:${g}:${u}`,l={customerPhone:o,customerCompany:e||"Regular Customer",customerLocation:r,customerAddress:n,items:a,status:"Pending",timestamp:s};T(I(k,"orders"),l).then(()=>{H(),a=[],localStorage.removeItem("cartItems"),p()}).catch(d=>{console.error(d),alert("Order failed")})});function H(){document.getElementById("booking-modal").classList.add("active")}window.closeBookingModal=()=>{document.getElementById("booking-modal").classList.remove("active"),window.location.href="index.html"};document.getElementById("clear-btn").addEventListener("click",()=>{a.length&&confirm("Clear bag?")&&(a=[],localStorage.removeItem("cartItems"),p())});p();function _(o){if(!o)return"";const n=o.match(/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/);return n?`${n[3]}-${n[2]}-${n[1]}`:""}const w=localStorage.getItem("phoneNumber"),j=localStorage.getItem("deliveryAddress")||"",F=localStorage.getItem("companyName")||"",h=new Date().toISOString().split("T")[0];if(w){const o=O(I(k,"orders"),M("customerPhone"),$(w));x(o,r=>{const e=document.getElementById("active-tracking");if(r.exists()){const t=r.val(),c=Object.values(t).reverse().find(i=>_(i.timestamp)===h&&["In Transit","Pending","Delivered","Completed"].includes(i.status));if(c){e.style.display="block";const i=e.querySelector("h4"),f=e.querySelector("p"),g=e.querySelector(".tracking-tag");if(c.status==="Delivered"||c.status==="Completed"){const u=`delivery_seen_${c.id}`;if(localStorage.getItem(u))e.style.display="none";else{e.style.display="block",g.textContent="Delivery Success",g.style.background="#27ae60",i.innerHTML='Delivery Complete! <i class="fas fa-check-circle" style="color: #27ae60; margin-left: 8px;"></i>',f.textContent="Your order has been delivered. Enjoy your ZCafe beverages!";const l=e.querySelector(".delivery-scene");l.style.display="block";const d=l.querySelector(".moving-bg");d&&(d.style.animationPlayState="paused");let m=l.querySelector(".success-overlay");m||(m=document.createElement("div"),m.className="success-overlay",m.innerHTML='<i class="fas fa-check-circle" style="font-size: 80px; color: #27ae60;"></i>',m.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(39, 174, 96, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    animation: fadeInScale 1s ease-out;
                    z-index: 10;
                  `,l.appendChild(m)),e.style.border="2px solid #27ae60",e.style.animation="pulse-success 2s infinite";const v=document.getElementById("dismiss-tracking-btn");v.style.display="block",v.onclick=()=>{localStorage.setItem(u,"true"),e.style.display="none",a=[],localStorage.removeItem("cartItems"),p()}}}else{g.textContent="Order Tracking",g.style.background="#aa0a0a",i.textContent=c.status==="Pending"?"Order Confirmed":"Your Order is on the Way!",f.textContent="Your fresh beverages are being prepared and will be delivered soon.",e.querySelector(".delivery-scene").style.display="block";const u=e.querySelector(".moving-bg");u&&(u.style.animationPlayState="running");const s=e.querySelector(".success-overlay");s&&s.remove(),e.style.border="none",e.style.animation="none"}}else e.style.display="none"}else e.style.display="none"});const n=I(k,"notifications");x(n,r=>{if(r.exists()){const e=r.val(),t=Object.values(e).sort((y,c)=>new Date(c.timestamp)-new Date(y.timestamp))[0];if(t&&t.title==="Delivery Complete!"){const y=t.targetLocation==="all"||t.targetLocation===j,c=t.targetCompany==="all"||t.targetCompany===F,i=t.targetDate===h,f=new Date(t.timestamp).getTime(),g=Date.now();if(y&&c&&i&&g-f<1800*1e3){if(Object.keys(localStorage).some(d=>d.startsWith("delivery_seen_")&&localStorage.getItem(d)==="true"))return;const s=document.getElementById("active-tracking"),l=s.querySelector("h4");if(s.style.display==="none"||!l.innerHTML.includes("Delivery Complete")){s.style.display="block";const d=s.querySelector("p"),m=s.querySelector(".tracking-tag");m.textContent="Delivery Alert",m.style.background="#27ae60",l.innerHTML='Delivery Complete! <i class="fas fa-check-circle" style="color: #27ae60; margin-left: 8px;"></i>',d.textContent=t.message;const v=s.querySelector(".delivery-scene");v.style.display="block";const C=v.querySelector(".moving-bg");C&&(C.style.animationPlayState="paused");let S=v.querySelector(".success-overlay");S||(S=document.createElement("div"),S.className="success-overlay",S.innerHTML='<i class="fas fa-check-circle" style="font-size: 80px; color: #27ae60;"></i>',S.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(39, 174, 96, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    animation: fadeInScale 1s ease-out;
                    z-index: 10;
                  `,v.appendChild(S)),s.style.border="2px solid #27ae60",s.style.animation="pulse-success 2s infinite";const D=document.getElementById("dismiss-tracking-btn");D.style.display="block",D.onclick=()=>{localStorage.setItem(`delivery_seen_notif_${h}`,"true"),s.style.display="none",a=[],localStorage.removeItem("cartItems"),p()}}}}}})}
