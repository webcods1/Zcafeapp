import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as j}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getDatabase as F,onValue as B,query as M,ref as f,remove as T,orderByChild as R,equalTo as _,update as S}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";const H="modulepreload",K=function(e){return"/"+e},L={},U=function(o,r,n){let s=Promise.resolve();if(r&&r.length>0){let c=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=c(r.map(i=>{if(i=K(i),i in L)return;L[i]=!0;const d=i.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${h}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":H,d||(u.as="script"),u.crossOrigin="",u.href=i,l&&u.setAttribute("nonce",l),document.head.appendChild(u),d)return new Promise((N,A)=>{u.addEventListener("load",N),u.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${i}`)))})}))}function t(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&t(l.reason);return o().catch(t)})},m=localStorage.getItem("adminBranch");m||(alert("Unauthorized access"),location.href="admin-login.html");document.getElementById("branch-label").textContent=m;const q=j({apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",authDomain:"zcafe-65f97.firebaseapp.com",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com",projectId:"zcafe-65f97",storageBucket:"zcafe-65f97.firebasestorage.app",messagingSenderId:"480288327990",appId:"1:480288327990:web:9c79040289023919034b97"}),p=F(q),I=document.getElementById("orders-list"),E=document.getElementById("newOrderSound");let g=[],$=0;const C=document.getElementById("service-list");let w=0;B(M(f(p,"service_requests")),e=>{if(C.innerHTML="",!e.exists()){C.innerHTML="<p style='color:#777; grid-column: 1/-1; text-align:center;'>No active service requests.</p>";return}const o=e.val();let r=[];if(console.log("Checking Service Requests..."),Object.entries(o).forEach(([n,s])=>{const t=(s.customerLocation||"").toLowerCase().trim(),a=(m||"").toLowerCase().trim();console.log(`Req [${n}] Loc: "${t}" vs Admin: "${a}"`),(t.includes(a)||a.includes(t)||t==="unknown location"||t==="unknown")&&r.push({id:n,...s})}),r.length===0){C.innerHTML=`<p style='color:#777; grid-column: 1/-1; text-align:center;'>No requests found for ${m}.</p>`;return}w>0&&r.length>w&&(E.currentTime=0,E.play().catch(n=>console.log("Audio play failed:",n))),w=r.length,r.reverse().forEach(n=>{const s=n.id,t=document.createElement("div");t.className="order-card",t.style.borderLeft="5px solid #d32f2f",t.innerHTML=`
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div>
                    <strong style="font-size:1.05rem; color:#d32f2f;">${n.type}</strong>
                    <div style="font-size:0.8rem; color:#888; margin-top:2px;">${n.timestamp}</div>
                </div>
                <span class="status-pill" style="background:#fee2e2; color:#b91c1c; height:fit-content; border-radius:12px; font-size:0.75rem;">${n.status}</span>
            </div>
            
            <div style="margin-bottom:12px; font-size:0.95rem;">
                <div style="font-size:0.8rem; color:#666;">Company:</div>
                <strong style="display:block; font-size:1.1rem; color:#111;">${n.customerCompany||"Unknown Company"}</strong>
                <a href="tel:${n.customerPhone}" style="display:inline-block; margin-top:4px; color:#2563eb; text-decoration:none; font-weight:500;">üìû ${n.customerPhone}</a>
                <div style="font-size:0.8rem; color:#888; margin-top:4px;">üìç ${n.customerLocation}</div>
            </div>
            
            <div style="background:#fff5f5; padding:12px; border-radius:8px; margin-bottom:15px; font-size:0.95rem; color:#333; border:1px solid #fee2e2;">
                <strong>Complaint:</strong><br>
                ${n.message}
            </div>
            
            <button onclick="window.deleteService('${s}')" class="service-done-btn">
                ‚úÖ Mark Resolved
            </button>
          `,C.appendChild(t)})});window.deleteService=e=>{confirm("Confirm: Request resolved and can be removed?")&&T(f(p,`service_requests/${e}`))};function x(e){if(!e)return console.log("Empty timestamp received"),"";const o=e.match(/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/);return o?`${o[3]}-${o[2]}-${o[1]}`:(console.log("Could not extract date from timestamp:",e),"")}console.log("Admin Branch:",m);B(M(f(p,"orders"),R("customerLocation"),_(m)),e=>{console.log("Orders snapshot exists:",e.exists()),document.getElementById("loading-msg").style.display="none",g=[];let o=0,r=0,n=0;const s=new Date().toISOString().split("T")[0];if(!e.exists()){console.log("No orders found for branch:",m),v();return}console.log("Orders data:",e.val());const t=e.val(),a=Object.keys(t).reverse();console.log(`Found ${a.length} total orders for branch ${m}`),$&&a.length>$&&E.play(),$=a.length,a.forEach(l=>{const c=t[l],i=x(c.timestamp);console.log(`Order ${l}: timestamp=${c.timestamp}, extractedDate=${i}, todayKey=${s}, match=${i===s}`),g.push({id:l,...c}),c.status==="Completed"?n++:r++,i===s&&o++}),todayCount.textContent=o,pendingCount.textContent=r,completedCount.textContent=n,v()});function v(){const e=searchInput.value.toLowerCase(),o=statusFilter.value,r=dateFilter.value;console.log(`Rendering orders - Total: ${g.length}, Search: "${e}", Status: ${o}, Date: ${r}`),I.innerHTML="";const n=g.filter(s=>{const a=`${s.customerPhone||""} ${s.customerCompany||""}`.toLowerCase().includes(e),l=o==="all"||s.status===o,c=!r||x(s.timestamp)===r;return a&&l&&c});console.log(`Filtered orders: ${n.length}`),n.forEach(s=>{const t=document.createElement("div");t.className="order-card"+(s.status==="Completed"?" completed":""),t.innerHTML=`
      <h3>${s.customerCompany||"Customer"}</h3>
      <small>${s.timestamp}</small>
      <p>üìû ${s.customerPhone}</p>
      <ul>${s.items.map(a=>`<li>${a.name} x ${a.quantity}</li>`).join("")}</ul>
      <div class="order-actions">
        <button class="done-btn" onclick="markComplete('${s.id}')">Done</button>
        <button class="delivered-btn" onclick="markDelivered('${s.id}')">Delivered</button>
        <button class="delete-btn" onclick="deleteOrder('${s.id}')">Delete</button>
      </div>
    `,I.appendChild(t)})}searchInput.oninput=v;statusFilter.onchange=v;dateFilter.onchange=v;window.markComplete=e=>confirm("Mark order completed?")&&S(f(p,"orders/"+e),{status:"Completed"});window.markDelivered=e=>confirm("Mark order as Delivered?")&&S(f(p,"orders/"+e),{status:"Delivered"});window.deleteOrder=e=>confirm("Delete order?")&&T(f(p,"orders/"+e));window.logoutAdmin=()=>{localStorage.removeItem("adminBranch"),location.href="admin-login.html"};const D={"Calicut City":["Others"],"Kannur City":["Others"],"Kasarakod City":["Others"],"Vatakara City":["BMH vatakara","C&C vatakara","Keerthimuthra vatakara","Dreame cinemas kallachi","Others"]},y=document.getElementById("notif-location"),b=document.getElementById("notif-company");for(let e in D){let o=document.createElement("option");o.value=e,o.textContent=e,y.appendChild(o)}y.onchange=()=>{const e=y.value;b.innerHTML='<option value="all">Target All Companies</option>',D[e]&&D[e].forEach(o=>{let r=document.createElement("option");r.value=o,r.textContent=o,b.appendChild(r)})};window.sendNotification=()=>{const e=document.getElementById("notif-title").value.trim(),o=document.getElementById("notif-msg").value.trim(),r=y.value,n=b.value;return!e||!o?alert("Fill title and message!"):P(e,o,r,n)};function P(e,o,r,n,s=null){if(!confirm(`Send this to ${r==="all"?"Everyone":n==="all"?r:n}?`))return Promise.resolve(!1);const t=f(p,"notifications/"+Date.now());return z(t,{title:e,message:o,targetLocation:r,targetCompany:n,targetDate:s,timestamp:new Date().toISOString(),sender:m}).then(()=>(alert("Notification sent!"),document.getElementById("notif-title").value="",document.getElementById("notif-msg").value="",!0))}let z;U(()=>import("https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js"),[]).then(e=>{z=e.set});window.markGroupDelivered=async()=>{const e=y.value,o=b.value,r=new Date().toISOString().split("T")[0];if(console.log("Mark Group Delivered clicked:"),console.log("- Selected Location:",e),console.log("- Selected Company:",o),console.log("- Today's Date:",r),console.log("- Total orders loaded:",g.length),e==="all")return alert("Please select a specific location first.");const n=g.filter(t=>{const a=x(t.timestamp),l=t.customerAddress===e||e==="all",c=t.customerCompany===o||o==="all",i=a===r,d=t.status!=="Delivered"&&t.status!=="Completed";return console.log(`Order ${t.id}:`,{customerAddress:t.customerAddress,customerCompany:t.customerCompany,customerLocation:t.customerLocation,orderDate:a,status:t.status,locMatch:l,compMatch:c,dateMatch:i,statusMatch:d}),l&&c&&i&&d});if(console.log("Matching orders found:",n.length),n.length===0){if(alert(`No active orders found for today.

Location: ${e}
Company: ${o}
Date: ${r}

Check console for details.`),!confirm("No orders found. Still send notification to this group?"))return}else if(!confirm(`Found ${n.length} order(s) to mark as Delivered.

Location: ${e}
Company: ${o}

Proceed?`))return;const s={};n.forEach(t=>{s[`orders/${t.id}/status`]="Delivered"}),Object.keys(s).length>0&&(await S(f(p),s),console.log("Updated orders:",Object.keys(s).length)),await P("Delivery Complete!","Your ZCafe order has been delivered! Enjoy your fresh beverages. ‚òï‚ú®",e,o,r),alert(`Success! ${n.length>0?n.length+" order(s) marked as delivered and":""} Notification sent!`)};const O=document.getElementById("notif-templates"),k={miss:{title:"Did you miss your tomorrow order?",msg:"Hi! We noticed you haven't placed your order for tomorrow yet. Don't forget to book your favorite ZCafe treat!"},welcome:{title:"Welcome to ZCafe!",msg:"Thank you for joining our community! Explore our premium coffee and tea collections today."},offer:{title:"Special Discount Inside!",msg:"Exclusive offer for your location! Order now and get a special surprise with your delivery."},delivery:{title:"Delivery Complete!",msg:"Your ZCafe order has been delivered! Enjoy your fresh beverages. ‚òï‚ú®"}};O.onchange=()=>{const e=O.value;k[e]&&(document.getElementById("notif-title").value=k[e].title,document.getElementById("notif-msg").value=k[e].msg)};dateFilter.value=new Date().toISOString().split("T")[0];
