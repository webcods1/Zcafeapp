import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as M}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getDatabase as P,onValue as T,query as N,ref as p,orderByChild as A,equalTo as j,update as E,remove as F}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";const _="modulepreload",z=function(e){return"/"+e},k={},K=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){let c=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");o=c(n.map(i=>{if(i=z(i),i in k)return;k[i]=!0;const d=i.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${h}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":_,d||(m.as="script"),m.crossOrigin="",m.href=i,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((L,x)=>{m.addEventListener("load",L),m.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${i}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return o.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})},u=localStorage.getItem("adminBranch");u||(alert("Unauthorized access"),location.href="admin-login.html");document.getElementById("branch-label").textContent=u;const q=M({apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",authDomain:"zcafe-65f97.firebaseapp.com",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com",projectId:"zcafe-65f97",storageBucket:"zcafe-65f97.firebasestorage.app",messagingSenderId:"480288327990",appId:"1:480288327990:web:9c79040289023919034b97"}),g=P(q),S=document.getElementById("orders-list"),R=document.getElementById("newOrderSound");let f=[],D=0;function w(e){if(!e)return console.log("Empty timestamp received"),"";const t=e.match(/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/);return t?`${t[3]}-${t[2]}-${t[1]}`:(console.log("Could not extract date from timestamp:",e),"")}console.log("Admin Branch:",u);T(N(p(g,"orders"),A("customerLocation"),j(u)),e=>{console.log("Orders snapshot exists:",e.exists()),document.getElementById("loading-msg").style.display="none",f=[];let t=0,n=0,s=0;const o=new Date().toISOString().split("T")[0];if(!e.exists()){console.log("No orders found for branch:",u),y();return}console.log("Orders data:",e.val());const r=e.val(),a=Object.keys(r).reverse();console.log(`Found ${a.length} total orders for branch ${u}`),D&&a.length>D&&R.play(),D=a.length,a.forEach(l=>{const c=r[l],i=w(c.timestamp);console.log(`Order ${l}: timestamp=${c.timestamp}, extractedDate=${i}, todayKey=${o}, match=${i===o}`),f.push({id:l,...c}),c.status==="Completed"?s++:n++,i===o&&t++}),todayCount.textContent=t,pendingCount.textContent=n,completedCount.textContent=s,y()});function y(){const e=searchInput.value.toLowerCase(),t=statusFilter.value,n=dateFilter.value;console.log(`Rendering orders - Total: ${f.length}, Search: "${e}", Status: ${t}, Date: ${n}`),S.innerHTML="";const s=f.filter(o=>{const a=`${o.customerPhone||""} ${o.customerCompany||""}`.toLowerCase().includes(e),l=t==="all"||o.status===t,c=!n||w(o.timestamp)===n;return a&&l&&c});console.log(`Filtered orders: ${s.length}`),s.forEach(o=>{const r=document.createElement("div");r.className="order-card"+(o.status==="Completed"?" completed":""),r.innerHTML=`
      <h3>${o.customerCompany||"Customer"}</h3>
      <small>${o.timestamp}</small>
      <p>ðŸ“ž ${o.customerPhone}</p>
      <ul>${o.items.map(a=>`<li>${a.name} x ${a.quantity}</li>`).join("")}</ul>
      <div class="order-actions">
        <button class="done-btn" onclick="markComplete('${o.id}')">Done</button>
        <button class="delivered-btn" onclick="markDelivered('${o.id}')">Delivered</button>
        <button class="delete-btn" onclick="deleteOrder('${o.id}')">Delete</button>
      </div>
    `,S.appendChild(r)})}searchInput.oninput=y;statusFilter.onchange=y;dateFilter.onchange=y;window.markComplete=e=>confirm("Mark order completed?")&&E(p(g,"orders/"+e),{status:"Completed"});window.markDelivered=e=>confirm("Mark order as Delivered?")&&E(p(g,"orders/"+e),{status:"Delivered"});window.deleteOrder=e=>confirm("Delete order?")&&F(p(g,"orders/"+e));window.logoutAdmin=()=>{localStorage.removeItem("adminBranch"),location.href="admin-login.html"};const b={"Calicut City":["Others"],"Kannur City":["Others"],"Kasarakod City":["Others"],"Vatakara City":["BMH vatakara","C&C vatakara","Keerthimuthra vatakara","Dreame cinemas kallachi","Others"]},v=document.getElementById("notif-location"),C=document.getElementById("notif-company");for(let e in b){let t=document.createElement("option");t.value=e,t.textContent=e,v.appendChild(t)}v.onchange=()=>{const e=v.value;C.innerHTML='<option value="all">Target All Companies</option>',b[e]&&b[e].forEach(t=>{let n=document.createElement("option");n.value=t,n.textContent=t,C.appendChild(n)})};window.sendNotification=()=>{const e=document.getElementById("notif-title").value.trim(),t=document.getElementById("notif-msg").value.trim(),n=v.value,s=C.value;return!e||!t?alert("Fill title and message!"):O(e,t,n,s)};function O(e,t,n,s,o=null){if(!confirm(`Send this to ${n==="all"?"Everyone":s==="all"?n:s}?`))return Promise.resolve(!1);const r=p(g,"notifications/"+Date.now());return B(r,{title:e,message:t,targetLocation:n,targetCompany:s,targetDate:o,timestamp:new Date().toISOString(),sender:u}).then(()=>(alert("Notification sent!"),document.getElementById("notif-title").value="",document.getElementById("notif-msg").value="",!0))}let B;K(()=>import("https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js"),[]).then(e=>{B=e.set});window.markGroupDelivered=async()=>{const e=v.value,t=C.value,n=new Date().toISOString().split("T")[0];if(console.log("Mark Group Delivered clicked:"),console.log("- Selected Location:",e),console.log("- Selected Company:",t),console.log("- Today's Date:",n),console.log("- Total orders loaded:",f.length),e==="all")return alert("Please select a specific location first.");const s=f.filter(r=>{const a=w(r.timestamp),l=r.customerAddress===e||e==="all",c=r.customerCompany===t||t==="all",i=a===n,d=r.status!=="Delivered"&&r.status!=="Completed";return console.log(`Order ${r.id}:`,{customerAddress:r.customerAddress,customerCompany:r.customerCompany,customerLocation:r.customerLocation,orderDate:a,status:r.status,locMatch:l,compMatch:c,dateMatch:i,statusMatch:d}),l&&c&&i&&d});if(console.log("Matching orders found:",s.length),s.length===0){if(alert(`No active orders found for today.

Location: ${e}
Company: ${t}
Date: ${n}

Check console for details.`),!confirm("No orders found. Still send notification to this group?"))return}else if(!confirm(`Found ${s.length} order(s) to mark as Delivered.

Location: ${e}
Company: ${t}

Proceed?`))return;const o={};s.forEach(r=>{o[`orders/${r.id}/status`]="Delivered"}),Object.keys(o).length>0&&(await E(p(g),o),console.log("Updated orders:",Object.keys(o).length)),await O("Delivery Complete!","Your ZCafe order has been delivered! Enjoy your fresh beverages. â˜•âœ¨",e,t,n),alert(`Success! ${s.length>0?s.length+" order(s) marked as delivered and":""} Notification sent!`)};const I=document.getElementById("notif-templates"),$={miss:{title:"Did you miss your tomorrow order?",msg:"Hi! We noticed you haven't placed your order for tomorrow yet. Don't forget to book your favorite ZCafe treat!"},welcome:{title:"Welcome to ZCafe!",msg:"Thank you for joining our community! Explore our premium coffee and tea collections today."},offer:{title:"Special Discount Inside!",msg:"Exclusive offer for your location! Order now and get a special surprise with your delivery."},delivery:{title:"Delivery Complete!",msg:"Your ZCafe order has been delivered! Enjoy your fresh beverages. â˜•âœ¨"}};I.onchange=()=>{const e=I.value;$[e]&&(document.getElementById("notif-title").value=$[e].title,document.getElementById("notif-msg").value=$[e].msg)};
