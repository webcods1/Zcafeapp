import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{initializeApp as L}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";import{getDatabase as M,push as H,ref as I,query as E,orderByChild as T,equalTo as $,onValue as D}from"https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";const O={apiKey:"AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",authDomain:"zcafe-65f97.firebaseapp.com",databaseURL:"https://zcafe-65f97-default-rtdb.firebaseio.com",projectId:"zcafe-65f97",storageBucket:"zcafe-65f97.firebasestorage.app",messagingSenderId:"480288327990",appId:"1:480288327990:web:9c79040289023919034b97"},P=L(O),k=M(P);let d=JSON.parse(localStorage.getItem("cartItems"))||[];const B=document.getElementById("bag-items"),x=document.getElementById("cart-badge");function q(){const s=d.reduce((n,r)=>n+r.quantity,0);x.textContent=s,x.style.display=s>0?"flex":"none"}function v(){B.innerHTML="";const s=document.querySelector(".actions"),n=document.getElementById("empty-cart-message");if(!d.length){B.innerHTML="",s&&(s.style.display="none"),n&&(n.style.display="block"),q();return}s&&(s.style.display="flex"),n&&(n.style.display="none"),d.forEach((r,e)=>{const t=document.createElement("div");t.className="bag-item",t.innerHTML=`
          <h3>${r.name}</h3>
          <input type="number" min="1" value="${r.quantity}">
          <button class="remove-btn">Remove</button>
        `,t.querySelector("input").onchange=p=>A(e,p.target.value),t.querySelector(".remove-btn").onclick=()=>N(e),B.appendChild(t)}),q()}function A(s,n){d[s].quantity=parseInt(n),localStorage.setItem("cartItems",JSON.stringify(d)),v()}function N(s){d.splice(s,1),localStorage.setItem("cartItems",JSON.stringify(d)),v()}v();document.getElementById("book-btn").addEventListener("click",()=>{if(!d.length){alert("Your bag is empty!");return}const s=localStorage.getItem("phoneNumber"),n=localStorage.getItem("deliveryAddress"),r=localStorage.getItem("deliverFrom"),e=localStorage.getItem("companyName");if(!s||!n||!r){alert("Please complete Profile (Phone, Address, Branch)"),window.location.href="profile.html";return}const t=new Date,p=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),m=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0"),a=`${p}/${i}/${o}, ${c}:${m}:${l}`,y={customerPhone:s,customerCompany:e||"Regular Customer",customerLocation:r,customerAddress:n,items:d,status:"Pending",timestamp:a};H(I(k,"orders"),y).then(()=>{z(),d=[],localStorage.removeItem("cartItems"),v()}).catch(u=>{console.error(u),alert("Order failed")})});function z(){document.getElementById("booking-modal").classList.add("active")}window.closeBookingModal=()=>{document.getElementById("booking-modal").classList.remove("active"),window.location.href="index.html"};document.getElementById("clear-btn").addEventListener("click",()=>{d.length&&confirm("Clear bag?")&&(d=[],localStorage.removeItem("cartItems"),v())});v();function j(){const s=document.getElementById("booking-history-content"),n=document.getElementById("history-arrow"),r=document.getElementById("history-toggle-header");s.style.display==="none"?(s.style.display="block",n.style.transform="rotate(180deg)",r.style.background="rgba(244, 231, 204, 0.3)"):(s.style.display="none",n.style.transform="rotate(0deg)",r.style.background="transparent")}window.toggleBookingHistory=j;function _(){const s=localStorage.getItem("phoneNumber");if(!s){document.getElementById("no-history-message").style.display="block";return}const n=E(I(k,"orders"),T("customerPhone"),$(s));D(n,r=>{const e=document.getElementById("booking-history-container"),t=document.getElementById("no-history-message");if(!r.exists()){e.innerHTML="",t.style.display="block";return}const p=r.val(),i=Object.entries(p).map(([o,c])=>({id:o,...c}));if(i.sort((o,c)=>{const m=l=>{if(!l)return 0;const[a,y]=l.split(", "),[u,g,f]=a.split("/"),[h,b,S]=(y||"00:00:00").split(":");return new Date(f,g-1,u,h,b,S).getTime()};return m(c.timestamp)-m(o.timestamp)}),i.length===0){e.innerHTML="",t.style.display="block";return}t.style.display="none",e.innerHTML=i.map(o=>{const c=o.items||[],m=c.reduce((a,y)=>a+(y.quantity||0),0);let l="status-pending";return o.status==="In Transit"&&(l="status-transit"),(o.status==="Delivered"||o.status==="Completed")&&(l="status-delivered"),`
            <div class="history-order-card">
              <div class="history-order-header">
                <span class="history-order-date">üìÖ ${o.timestamp||"Date unavailable"}</span>
                <span class="history-status-badge ${l}">${o.status||"Pending"}</span>
              </div>
              <div>
                <strong style="color: #333;">üìç ${o.customerLocation||"Branch not specified"}</strong>
                ${o.customerCompany?`<br><span style="color: #666; font-size: 0.85rem;">üè¢ ${o.customerCompany}</span>`:""}
              </div>
              <ul class="history-items-list">
                ${c.map(a=>`
                  <li>${a.quantity||1}√ó ${a.name||"Unknown item"}</li>
                `).join("")}
              </ul>
              <div class="history-order-total">
                Total Items: ${m}
              </div>
            </div>
          `}).join("")})}_();function R(s){if(!s)return"";const n=s.match(/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/);return n?`${n[3]}-${n[2]}-${n[1]}`:""}const w=localStorage.getItem("phoneNumber"),F=localStorage.getItem("deliveryAddress")||"",Y=localStorage.getItem("companyName")||"",C=new Date().toISOString().split("T")[0];if(w){const s=E(I(k,"orders"),T("customerPhone"),$(w));D(s,r=>{const e=document.getElementById("active-tracking");if(r.exists()){const t=r.val(),i=Object.values(t).reverse().find(o=>R(o.timestamp)===C&&["In Transit","Pending","Delivered","Completed"].includes(o.status));if(i){e.style.display="block";const o=e.querySelector("h4"),c=e.querySelector("p"),m=e.querySelector(".tracking-tag");if(i.status==="Delivered"||i.status==="Completed"){const l=`delivery_seen_${i.id}`;if(localStorage.getItem(l))e.style.display="none";else{e.style.display="block",m.textContent="Delivery Success",m.style.background="#27ae60",o.innerHTML='Delivery Complete! <i class="fas fa-check-circle" style="color: #27ae60; margin-left: 8px;"></i>',c.textContent="Your order has been delivered. Enjoy your ZCafe beverages!";const y=e.querySelector(".delivery-scene");y.style.display="block";const u=y.querySelector(".moving-bg");u&&(u.style.animationPlayState="paused");let g=y.querySelector(".success-overlay");g||(g=document.createElement("div"),g.className="success-overlay",g.innerHTML='<i class="fas fa-check-circle" style="font-size: 80px; color: #27ae60;"></i>',g.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(39, 174, 96, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    animation: fadeInScale 1s ease-out;
                    z-index: 10;
                  `,y.appendChild(g)),e.style.border="2px solid #27ae60",e.style.animation="pulse-success 2s infinite";const f=document.getElementById("dismiss-tracking-btn");f.style.display="block",f.onclick=()=>{localStorage.setItem(l,"true"),e.style.display="none",d=[],localStorage.removeItem("cartItems"),v()}}}else{m.textContent="Order Tracking",m.style.background="#aa0a0a",o.textContent=i.status==="Pending"?"Order Confirmed":"Your Order is on the Way!",c.textContent="Your fresh beverages are being prepared and will be delivered soon.",e.querySelector(".delivery-scene").style.display="block";const l=e.querySelector(".moving-bg");l&&(l.style.animationPlayState="running");const a=e.querySelector(".success-overlay");a&&a.remove(),e.style.border="none",e.style.animation="none"}}else e.style.display="none"}else e.style.display="none"});const n=I(k,"notifications");D(n,r=>{if(r.exists()){const e=r.val(),t=Object.values(e).sort((p,i)=>new Date(i.timestamp)-new Date(p.timestamp))[0];if(t&&t.title==="Delivery Complete!"){const p=t.targetLocation==="all"||t.targetLocation===F,i=t.targetCompany==="all"||t.targetCompany===Y,o=t.targetDate===C,c=new Date(t.timestamp).getTime(),m=Date.now();if(p&&i&&o&&m-c<1800*1e3){if(Object.keys(localStorage).some(u=>u.startsWith("delivery_seen_")&&localStorage.getItem(u)==="true"))return;const a=document.getElementById("active-tracking"),y=a.querySelector("h4");if(a.style.display==="none"||!y.innerHTML.includes("Delivery Complete")){a.style.display="block";const u=a.querySelector("p"),g=a.querySelector(".tracking-tag");g.textContent="Delivery Alert",g.style.background="#27ae60",y.innerHTML='Delivery Complete! <i class="fas fa-check-circle" style="color: #27ae60; margin-left: 8px;"></i>',u.textContent=t.message;const f=a.querySelector(".delivery-scene");f.style.display="block";const h=f.querySelector(".moving-bg");h&&(h.style.animationPlayState="paused");let b=f.querySelector(".success-overlay");b||(b=document.createElement("div"),b.className="success-overlay",b.innerHTML='<i class="fas fa-check-circle" style="font-size: 80px; color: #27ae60;"></i>',b.style.cssText=`
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(39, 174, 96, 0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    animation: fadeInScale 1s ease-out;
                    z-index: 10;
                  `,f.appendChild(b)),a.style.border="2px solid #27ae60",a.style.animation="pulse-success 2s infinite";const S=document.getElementById("dismiss-tracking-btn");S.style.display="block",S.onclick=()=>{localStorage.setItem(`delivery_seen_notif_${C}`,"true"),a.style.display="none",d=[],localStorage.removeItem("cartItems"),v()}}}}}})}
