<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Service - ZCafe</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <link rel="stylesheet" href="desktop.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom, #e48435, #e2eaf3);
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .main-content {
      flex: 1;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;

    }

    .main-content h1 {
      text-align: center;
      color: #000000;
      margin-bottom: 30px;
      font-size: 2rem;
    }

    form {
      background: transparent;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    select,
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      margin-bottom: 20px;
      box-sizing: border-box;
    }

    select:focus,
    textarea:focus {
      outline: none;
      border-color: #aa0a0a;
      box-shadow: 0 0 5px rgba(170, 10, 10, 0.3);
    }

    button[type="submit"] {
      background-color: #aa0a0a;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      width: auto;
      display: block;
      margin: 0 auto;
      transition: background-color 0.3s;
    }

    button[type="submit"]:hover {
      background-color: #880808;
    }

    .bottom-nav {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: #fff;
      padding: 10px 0;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      position: fixed;
      bottom: 0;
      width: 100%;
      z-index: 1000;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #ffffff;
      font-size: 0.8rem;
      transition: color 0.3s;
    }

    .nav-item.active {
      color: #aa0a0a;
    }

    .nav-item svg {
      width: 24px;
      height: 24px;
      margin-bottom: 4px;
    }

    .nav-item:hover {
      color: #aa0a0a;
    }

    button[onclick="window.history.back()"] {
      background: #aa0a0a;
      border: none;
      color: white;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
      margin-bottom: 20px;
    }

    button[onclick="window.history.back()"]:hover {
      background: #880808;
    }

    /* Notification Toast */
    #notification-container {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #2e7d32, #43a047);
      /* Green for success */
      color: white;
      padding: 16px 24px;
      border-radius: 30px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      font-weight: 600;
      text-align: center;
      width: 90%;
      max-width: 400px;
      font-size: 0.95rem;
      animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes slideUp {
      from {
        transform: translate(-50%, 100px);
        opacity: 0;
      }

      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
  </style>
</head>

<body class="no-top-nav">
  <div id="notification-container"></div>

  <script>
    (function () {
      var loader = document.createElement('div');
      loader.className = 'app-loader';
      loader.innerHTML = '<div class="logo" aria-hidden="true"></div>';
      document.documentElement.appendChild(loader);
      function removeLoader() { loader.classList.add('loaded'); setTimeout(() => { if (loader && loader.parentNode) loader.parentNode.removeChild(loader); }, 350); }
      if (document.readyState === 'complete') removeLoader(); else window.addEventListener('load', removeLoader);
      window.addEventListener('beforeunload', function () { if (!document.documentElement.contains(loader)) document.documentElement.appendChild(loader); });
    })();
  </script>



  <main class="main-content">
    <h1>Machine Service </h1>
    <form id="complaint-form">
      <label for="complaint-type">Complaint Type</label>
      <select id="complaint-type" required>
        <option value="Machine not turning on">Machine not turning on</option>
        <option value="Water not heating">Water not heating</option>
        <option value="Switch complaints">Switch complaints</option>
        <option value="Other">Other</option>
      </select>

      <label for="complaint-message">Message</label>
      <textarea id="complaint-message" placeholder="Describe your complaint in detail..." required></textarea>

      <div class="service-animation-container">
        <!-- Vehicle -->
        <svg class="service-vehicle-page" id="service-gear" viewBox="0 0 24 24" fill="#aa0a0a">
          <path
            d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
        </svg>

        <!-- Button -->
        <button type="button" id="send-complaint-btn" class="service-button-page">
          Send Complaint <i class="fas fa-arrow-right"></i>
        </button>

        <!-- Track -->
        <div class="service-track-page"></div>
      </div>
    </form>

    <style>
      .service-animation-container {
        position: relative;
        height: 120px;
        /* Space for animation */
        margin-top: 30px;
        overflow: visible;
        /* Allow icon to roll from outside */
      }

      .service-track-page {
        position: absolute;
        bottom: -250px;
        left: -100px;
        /* Extend beyond left edge */
        right: -100px;
        /* Extend beyond right edge */
        height: 6px;
        background: #000;
      }

      .service-button-page {
        position: absolute;
        bottom: 60px;
        /* Adjusted to be above track */
        left: 50%;
        transform: translateX(-50%);
        width: auto;
        padding: 12px 30px;
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: #aa0a0a;
        border: 1.5px solid rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 20;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: -5px;
      }

      .service-button-page:hover {
        background: rgba(255, 255, 255, 0.45);
        border-color: #aa0a0a;
        transform: translateX(-50%) scale(1.05);
      }

      @keyframes arrowSlide {

        0%,
        100% {
          transform: translateX(0);
        }

        50% {
          transform: translateX(4px);
        }
      }

      .service-button-page i {
        animation: arrowSlide 1.2s ease-in-out infinite;
      }

      .service-vehicle-page {
        width: 50px;
        height: 50px;
        fill: #000000;
        position: absolute;
        bottom: -250px;
        /* Sit on track */
        left: -60px;
        /* Start offscreen */
        z-index: 10;
        transform-origin: center;
      }

      /* Entrance Animation (Left -> Center) */
      @keyframes scrollIn {
        0% {
          left: -60px;
          transform: translateX(0) rotate(0deg);
        }

        100% {
          left: 50%;
          transform: translateX(-50%) rotate(720deg);
        }
      }

      /* Exit Animation (Center -> Right Out) */
      @keyframes scrollOut {
        0% {
          left: 50%;
          transform: translateX(-50%) rotate(0deg);
        }

        100% {
          left: 120%;
          transform: translateX(0) rotate(720deg);
        }
      }

      .animate-enter {
        animation: scrollIn 2s ease-out forwards;
      }

      .animate-exit {
        animation: scrollOut 2s ease-in forwards;
      }

      /* Desktop: Set track to 100% width */
      @media (min-width: 761px) {
        .service-track-page {
          position: absolute;
          bottom: 10px;
          left: -600px;
          /* Extend beyond left edge */
          right: -600px;
          /* Extend beyond right edge */
          height: 6px;
          background: #000;
        }

        .service-vehicle-page {
          width: 50px;
          height: 50px;
          fill: #aa0a0a;
          position: absolute;
          bottom: 16px;
          /* Sit on track */
          left: -60px;
          /* Start offscreen */
          z-index: 10;
          transform-origin: center;
        }

        /* Entrance Animation (Left -> Center) */
        @keyframes scrollIn {
          0% {
            left: -590px;
            transform: translateX(0) rotate(0deg);
          }

          100% {
            left: 50%;
            transform: translateX(-50%) rotate(720deg);
          }
        }

        /* Exit Animation (Center -> Right Out) */
        @keyframes scrollOut {
          0% {
            left: 50%;
            transform: translateX(-50%) rotate(0deg);
          }

          100% {
            left: 300%;
            transform: translateX(0) rotate(720deg);
          }
        }

        .animate-enter {
          animation: scrollIn 2s ease-out forwards;
        }

        .animate-exit {
          animation: scrollOut 2s ease-in forwards;
        }

      }
    </style>
  </main>

  <!-- ===== Footer ===== -->
  <footer class="footer">
    <p>&copy; 2025 ZCafe. All rights reserved by Webcods</p>
  </footer>

  <!-- ===== Bottom Navigation ===== -->
  <div class="bottom-nav">
    <a class="nav-item" href="index.html" id="home-link">
      <svg viewBox="0 0 24 24">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2h-4v-7h-6v7H5a2 2 0 0 1-2-2Z" />
      </svg>
      Home
    </a>
    <a class="nav-item" href="purchase.html" id="purchase-link">
      <svg viewBox="0 0 24 24">
        <path d="M20 7l-8-4-8 4v10l8 4 8-4z M12 3v10 M8 5v10 M16 5v10" />
      </svg>
      Purchase
    </a>
    <a class="nav-item active" href="service.html" id="service-link">
      <svg viewBox="0 0 24 24" fill="#000">
        <path
          d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
      </svg>
      Service
    </a>
    <a class="nav-item" href="bag.html" id="bag-link">
      <svg viewBox="0 0 24 24">
        <path d="M6 7V6a6 6 0 0 1 12 0v1h2v14H4V7Zm2 0h8V6a4 4 0 0 0-8 0Z" />
      </svg>
      Cart
    </a>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBD_s0bu-ei-bsdPDIFaDF6gbuck-85hbM",
      authDomain: "zcafe-65f97.firebaseapp.com",
      databaseURL: "https://zcafe-65f97-default-rtdb.firebaseio.com",
      projectId: "zcafe-65f97",
      storageBucket: "zcafe-65f97.firebasestorage.app",
      messagingSenderId: "480288327990",
      appId: "1:480288327990:web:9c79040289023919034b97"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Show Notification Helper
    function showNotification(msg, duration = 4000) {
      const container = document.getElementById('notification-container');
      container.textContent = msg;
      container.style.display = 'flex';
      container.style.animation = 'slideUp 0.5s ease forwards';

      setTimeout(() => {
        container.style.opacity = '0';
        setTimeout(() => {
          container.style.display = 'none';
          container.style.opacity = '1';
        }, 500);
      }, duration);
    }

    // Initialize Animations
    const serviceGear = document.getElementById('service-gear');
    const sendBtn = document.getElementById('send-complaint-btn');
    const complaintForm = document.getElementById('complaint-form');

    // On Load: Scroll icon from left to center
    window.addEventListener('load', () => {
      serviceGear.classList.add('animate-enter');
    });

    // Handle Button Click
    sendBtn.addEventListener('click', () => {
      const type = document.getElementById('complaint-type').value;
      const message = document.getElementById('complaint-message').value.trim();

      // Simple validation
      if (!type || !message) {
        showNotification('Please fill in all fields (Type & Message).');
        return;
      }

      // Trigger Exit Animation (Center -> Right Out)
      serviceGear.classList.remove('animate-enter');
      serviceGear.classList.add('animate-exit');

      // Wait for animation to finish, then process submission
      serviceGear.addEventListener('animationend', () => {
        // Submit Logic
        submitComplaint(type, message);
      }, { once: true });
    });

    function submitComplaint(type, message) {
      // Get user info from localStorage
      const phone = localStorage.getItem('phoneNumber') || 'Unknown';
      const company = localStorage.getItem('companyName') || 'Unknown Company';
      const location = localStorage.getItem('deliveryAddress') || 'Unknown Location';

      const newRequestRef = push(ref(db, 'service_requests'));

      set(newRequestRef, {
        type: type,
        message: message,
        customerPhone: phone,
        customerCompany: company,
        customerLocation: location,
        status: 'Pending',
        timestamp: new Date().toLocaleString()
      }).then(() => {
        showNotification("The servicer will call you immediately! ðŸ“ž");
        complaintForm.reset();

        // Reset Animation for next time (Optional)
        setTimeout(() => {
          serviceGear.classList.remove('animate-exit');
          serviceGear.classList.add('animate-enter');
        }, 1000);

      }).catch((err) => {
        console.error(err);
        showNotification("Error submitting request. Please try again.");
      });
    }

    // Scroll hide/show navbars
    let lastScrollTop = 0;
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const bottomNav = document.querySelector('.bottom-nav');
      if (scrollTop > lastScrollTop) {
        // scrolling down
        if (bottomNav) bottomNav.classList.add('hidden');
      } else {
        // scrolling up
        if (bottomNav) bottomNav.classList.remove('hidden');
      }
      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });

  </script>
</body>

</html>